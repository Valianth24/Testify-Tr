"use strict";!function(){const e={initialized:!1,dom:{promptInput:null,generateBtn:null,apiKeyInput:null,subjectInput:null,questionCountInput:null,questionCountSlider:null,difficultySelect:null,topicsInput:null,examTypeSelect:null,examNameInput:null,questionTimeInput:null,osymStandardsToggle:null,loadSavedTestBtn:null},resolveElement(...e){for(const t of e){if(!t)continue;const e=document.getElementById(t);if(e)return e}return null},cacheDom(){this.dom.promptInput=this.resolveElement("aiPromptInput","testifyPromptInput","promptInput"),this.dom.generateBtn=this.resolveElement("generateTestBtn","aiGenerateBtn","btnGenerateTest"),this.dom.apiKeyInput=this.resolveElement("apiKeyInput","openaiApiKey","testifyApiKey"),this.dom.subjectInput=this.resolveElement("subjectInput","testSubjectInput"),this.dom.questionCountInput=this.resolveElement("questionCountInput","questionCount"),this.dom.questionCountSlider=this.resolveElement("questionCountSlider","questionCountRange"),this.dom.difficultySelect=this.resolveElement("difficultySelect","difficulty","testDifficulty"),this.dom.topicsInput=this.resolveElement("topicsInput","topicsField"),this.dom.examTypeSelect=this.resolveElement("examTypeSelect","examType"),this.dom.examNameInput=this.resolveElement("examNameInput","testNameInput"),this.dom.questionTimeInput=this.resolveElement("questionTimeInput","questionTime"),this.dom.osymStandardsToggle=this.resolveElement("osymStandardsToggle","osymModeToggle"),this.dom.loadSavedTestBtn=this.resolveElement("loadSavedTestBtn","btnLoadSavedTest")},attachEvents(){const e=this;this.dom.generateBtn&&this.dom.generateBtn.addEventListener("click",(function(t){t.preventDefault(),e.handleGenerateClick()})),this.dom.promptInput&&this.dom.promptInput.addEventListener("keydown",(function(t){(t.ctrlKey||t.metaKey)&&"Enter"===t.key&&(t.preventDefault(),e.handleGenerateClick())})),this.dom.loadSavedTestBtn&&this.dom.loadSavedTestBtn.addEventListener("click",(function(t){t.preventDefault(),e.handleLoadSavedTest()})),this.dom.questionCountSlider&&this.dom.questionCountInput&&(this.dom.questionCountSlider.addEventListener("input",(function(){e.dom.questionCountInput.value=String(e.dom.questionCountSlider.value)})),this.dom.questionCountInput.addEventListener("input",(function(){const t=parseInt(e.dom.questionCountInput.value,10);isNaN(t)||(e.dom.questionCountSlider.value=String(t))})))},buildOptionsFromUI(e){const t=(this.dom.subjectInput?.value||"").trim()||"Genel";let n=10;if(this.dom.questionCountInput&&this.dom.questionCountInput.value){const e=parseInt(this.dom.questionCountInput.value,10);!isNaN(e)&&e>0&&(n=e)}else if(this.dom.questionCountSlider&&this.dom.questionCountSlider.value){const e=parseInt(this.dom.questionCountSlider.value,10);!isNaN(e)&&e>0&&(n=e)}const i=(this.dom.difficultySelect?.value||"").trim()||"orta",s=(this.dom.topicsInput?.value||"").trim(),o=s?s.split(",").map((e=>e.trim())).filter(Boolean):[],a=(this.dom.examTypeSelect?.value||"").trim()||"generic",l=(this.dom.examNameInput?.value||"").trim()||a||"Genel Test";let u=90;if(this.dom.questionTimeInput&&this.dom.questionTimeInput.value){const e=parseInt(this.dom.questionTimeInput.value,10);!isNaN(e)&&e>0&&(u=e)}return{subject:t,questionCount:n,difficulty:i,topics:o,originalRequest:e,examType:a,examInfo:{name:l,questionTime:u,optionCount:5,bloomPreference:["understand","apply","analyze"],osymStandards:!(!this.dom.osymStandardsToggle||!this.dom.osymStandardsToggle.checked)}}},syncApiKeyToTestify(){if(!window.TestifyAI)return;const e=this.dom.apiKeyInput;e&&e.value&&"function"==typeof window.TestifyAI.config?.setApiKey&&window.TestifyAI.config.setApiKey(e.value.trim())},async handleGenerateClick(){if(!window.TestifyAI||"function"!=typeof window.TestifyAI.generateTestFromAI)return console.error("TestifyAI veya generateTestFromAI fonksiyonu bulunamadÄ±. LÃ¼tfen testify-ai.js dosyasÄ±nÄ±n yÃ¼klÃ¼ olduÄŸundan emin olun."),void alert("Testify AI sistemi yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin veya geliÅŸtiriciye bildirin.");const e=this.dom.promptInput,t=this.dom.generateBtn,n=(e?.value||"").trim();if(!n)return alert("LÃ¼tfen hangi konuda test istediÄŸini yaz :)"),void(e&&e.focus());this.syncApiKeyToTestify(),t&&(t.disabled=!0,t.dataset.originalText=t.dataset.originalText||t.textContent,t.textContent="OluÅŸturuluyor..."),"function"==typeof window.TestifyAI.addMessage&&window.TestifyAI.addMessage(n,"user");const i=this.buildOptionsFromUI(n);try{await window.TestifyAI.generateTestFromAI(n,i)}catch(e){console.error("âŒ Test oluÅŸturma hatasÄ± (chat-bridge):",e),"function"==typeof window.TestifyAI.addMessage&&window.TestifyAI.addMessage(`ğŸš¨ Test oluÅŸturma sÄ±rasÄ±nda bir hata oluÅŸtu.\n\n**Detay:** ${e.message||e}`,"ai")}finally{t&&(t.disabled=!1,t.dataset.originalText?t.textContent=t.dataset.originalText:t.textContent="Testi OluÅŸtur")}},handleLoadSavedTest(){if(!window.TestifyAI||"function"!=typeof window.TestifyAI.loadSavedTest)return void console.error("TestifyAI.loadSavedTest fonksiyonu bulunamadÄ±.");const e=window.TestifyAI.loadSavedTest();if(e){if("function"==typeof window.TestifyAI.addMessage){const t=e.questions?.length||0;window.TestifyAI.addMessage(`âœ… KayÄ±tlÄ± test yÃ¼klendi.\n\nâ€¢ BaÅŸlÄ±k: ${e.title||"KayÄ±tlÄ± Test"}\nâ€¢ Soru SayÄ±sÄ±: ${t}\nâ€¢ Konu: ${e.metadata&&e.metadata.subject||"Belirtilmedi"}`,"ai")}"function"==typeof window.TestifyAI.highlightTestTab&&window.TestifyAI.highlightTestTab()}else"function"==typeof window.TestifyAI.addMessage?window.TestifyAI.addMessage("ğŸ“¦ KayÄ±tlÄ± bir test bulunamadÄ±. Ã–nce bir test oluÅŸturup Ã§Ã¶zmeyi deneyebilirsin.","ai"):alert("KayÄ±tlÄ± test bulunamadÄ±.")},sendWelcomeMessage(){if(!window.TestifyAI||"function"!=typeof window.TestifyAI.addMessage)return;sessionStorage.getItem("testify_welcome_shown")||(window.TestifyAI.addMessage('ğŸ‘‹ Merhaba, ben **Testify AI Profesyonel Ã–ÄŸretmen**.\n\nâ€¢ Ä°stediÄŸin **konuyu** yaz (Ã¶r: "Yapay zeka temel kavramlarÄ±", "Matematik: Limit", "Python dÃ¶ngÃ¼ler")\nâ€¢ SaÄŸdan **soru sayÄ±sÄ±nÄ±** ve **zorluk seviyesini** seÃ§\nâ€¢ ArdÄ±ndan **"Testi OluÅŸtur"** butonuna tÄ±kla\n\nHer soru 5 ÅŸÄ±klÄ± ve doÄŸru cevaplar **Aâ€“E arasÄ±nda dengeli & rastgele** daÄŸÄ±tÄ±lmÄ±ÅŸ olacak.\n\nHazÄ±rsan, ne Ã§alÄ±ÅŸmak istediÄŸini yazalÄ±m ğŸ¯',"ai"),sessionStorage.setItem("testify_welcome_shown","1"))},init(){this.initialized||(this.initialized=!0,console.log("\n"+"â”€".repeat(80)),console.log("ğŸ”Œ TESTIFY CHAT BRIDGE v11 baÅŸlatÄ±lÄ±yor..."),console.log("â”€".repeat(80)),window.TestifyAI?(this.cacheDom(),this.attachEvents(),this.sendWelcomeMessage(),console.log("âœ… TestifyChatBridge hazÄ±r (UI â†” TestifyAI entegrasyonu aktif)."),console.log("â”€".repeat(80)+"\n")):console.error("âŒ TestifyAI global nesnesi bulunamadÄ±. LÃ¼tfen testify-ai.js dosyasÄ±nÄ±n yÃ¼klÃ¼ olduÄŸundan emin olun."))}};window.TestifyChatBridge=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){e.init()})):e.init()}();
