"use strict";const TestifyAI={version:"12.0.1-PROFESSIONAL-BACKEND",name:"Testify AI - Professional Education System",config:{apiKey:null,setApiKey(e){this.apiKey=e,window.TESTIFY_CONFIG&&(window.TESTIFY_CONFIG.API_KEY=e)},getApiKey(){return this.apiKey||window.TESTIFY_CONFIG?.API_KEY||""}},state:{isGenerating:!1,lastRequest:0,currentTest:null},ui:{isOpen:!0,isMinimized:!1,panel:null,toggleBtn:null,closeBtn:null,minimizeBtn:null,expandBtn:null},educationalFramework:{bloomTaxonomy:{remember:{level:1,verbs:["tanÄ±mla","listele","hatÄ±rla","tanÄ±"],cognitiveLoad:"low",scaffolding:"direct instruction + mnemonic devices"},understand:{level:2,verbs:["aÃ§Ä±kla","Ã¶zetle","sÄ±nÄ±flandÄ±r","karÅŸÄ±laÅŸtÄ±r"],cognitiveLoad:"medium",scaffolding:"analogies + visual representations"},apply:{level:3,verbs:["uygula","Ã§Ã¶z","kullan","hesapla"],cognitiveLoad:"medium-high",scaffolding:"worked examples + guided practice"},analyze:{level:4,verbs:["ayÄ±r","incele","karÅŸÄ±laÅŸtÄ±r","organize et"],cognitiveLoad:"high",scaffolding:"graphic organizers + case studies"},evaluate:{level:5,verbs:["deÄŸerlendir","eleÅŸtir","savun","karar ver"],cognitiveLoad:"very-high",scaffolding:"criteria sheets + metacognitive prompts"},create:{level:6,verbs:["tasarla","oluÅŸtur","planla","Ã¼ret"],cognitiveLoad:"extreme",scaffolding:"project-based learning + synthesis tasks"}},cognitiveLoadOptimization:{intrinsicLoad:"Konunun doÄŸal karmaÅŸÄ±klÄ±ÄŸÄ±",extraneousLoad:"Minimize edilmeli",germaneLoad:"Maksimize edilmeli",strategies:["worked examples effect","split-attention minimization","modality effect utilization","redundancy elimination"]}},requestManager:{lastRequestTime:0,minInterval:1e3,async waitIfNeeded(){const e=Date.now()-this.lastRequestTime;if(e<this.minInterval){const n=this.minInterval-e;console.log(`â³ Rate limiting: ${n}ms bekleniyor...`),await new Promise((e=>setTimeout(e,n)))}this.lastRequestTime=Date.now()}},estimateTokens:e=>Math.ceil(e.length/3.5),escapeHTML:e=>e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",renderContent(e){return this.escapeHTML(e).replace(/\n/g,"<br>")},shuffleArray(e){for(let n=e.length-1;n>0;n--){const a=Math.floor(Math.random()*(n+1));[e[n],e[a]]=[e[a],e[n]]}return e},addMessage(e,n="ai"){const a=document.getElementById("aiChat");if(!a)return void console.error("aiChat container not found");const t="user"===n||"human"===n,i=document.createElement("div");i.className="ai-message "+(t?"ai-message--user":"ai-message--ai");const s=document.createElement("div");s.className="message-bubble message-bubble--"+(t?"user":"ai");const r=document.createElement("div");r.className="message-content",r.innerHTML=this.renderContent(e),s.appendChild(r),i.appendChild(s),a.appendChild(i),a.scrollTop=a.scrollHeight},clearChat(){const e=document.getElementById("aiChat");e&&(e.innerHTML="")},showTypingIndicator(){const e=document.getElementById("typingIndicator");e&&(e.style.display="flex")},hideTypingIndicator(){const e=document.getElementById("typingIndicator");e&&(e.style.display="none")},highlightTestTab(){const e=document.querySelector('[data-tab="test"]');e&&(e.classList.add("highlight-pulse"),setTimeout((()=>e.classList.remove("highlight-pulse")),3e3))},initUI(){try{const e=document.querySelector("[data-ai-panel], #aiPanel, #aiAssistantPanel, #aiChatPanel");this.ui.panel=e;const n=document.querySelector("[data-ai-toggle], #aiToggleBtn, #openAiPanelBtn"),a=document.querySelector("[data-ai-close], #aiCloseBtn"),t=document.querySelector("[data-ai-minimize], #aiMinimizeBtn"),i=document.querySelector("[data-ai-expand], #aiExpandBtn");this.ui.toggleBtn=n,this.ui.closeBtn=a,this.ui.minimizeBtn=t,this.ui.expandBtn=i,e?(e.classList.add("ai-panel--open"),e.classList.remove("ai-panel--closed"),e.classList.remove("ai-panel--minimized"),this.ui.isOpen=!0,this.ui.isMinimized=!1):console.warn("âš ï¸ AI panel bulunamadÄ± (data-ai-panel / #aiPanel / #aiAssistantPanel / #aiChatPanel)"),n&&n.addEventListener("click",(e=>{e.preventDefault(),this.togglePanel()})),a&&a.addEventListener("click",(e=>{e.preventDefault(),this.closePanel()})),t&&t.addEventListener("click",(e=>{e.preventDefault(),this.toggleMinimize()})),i&&i.addEventListener("click",(e=>{e.preventDefault(),this.expandPanel()})),console.log("âœ… TestifyAI UI kontrolleri hazÄ±r (aÃ§/kapa/kÃ¼Ã§Ã¼lt)")}catch(e){console.error("âŒ TestifyAI UI init hatasÄ±:",e)}},openPanel(){const e=this.ui.panel;e&&(e.classList.add("ai-panel--open"),e.classList.remove("ai-panel--closed"),e.classList.remove("ai-panel--minimized"),this.ui.isOpen=!0,this.ui.isMinimized=!1)},closePanel(){const e=this.ui.panel;e&&(e.classList.remove("ai-panel--open"),e.classList.add("ai-panel--closed"),e.classList.remove("ai-panel--minimized"),this.ui.isOpen=!1,this.ui.isMinimized=!1)},togglePanel(){this.ui.isOpen?this.closePanel():this.openPanel()},toggleMinimize(){const e=this.ui.panel;e&&(this.ui.isMinimized=!this.ui.isMinimized,this.ui.isMinimized?(e.classList.add("ai-panel--minimized"),e.classList.add("ai-panel--open"),e.classList.remove("ai-panel--closed"),this.ui.isOpen=!0):(e.classList.remove("ai-panel--minimized"),e.classList.add("ai-panel--open"),e.classList.remove("ai-panel--closed"),this.ui.isOpen=!0))},expandPanel(){const e=this.ui.panel;e&&(e.classList.remove("ai-panel--minimized"),e.classList.add("ai-panel--open"),e.classList.remove("ai-panel--closed"),this.ui.isMinimized=!1,this.ui.isOpen=!0)},buildPrompt(e){const n=e.examInfo,a=e.subject,t=e.topics,i=e.difficulty,s=e.questionCount;return{systemPrompt:`Sen profesyonel bir eÄŸitim iÃ§eriÄŸi Ã¼reticisisin. GÃ¶revin, Ã¶ÄŸrencilere gerÃ§ekten Ã¶ÄŸreten, kaliteli sÄ±nav sorularÄ± oluÅŸturmak.\n\nEÄÄ°TÄ°MSEL Ä°LKELER:\n1. Bilgi ÅemalarÄ± OluÅŸtur: Ã–nceki bilgiyi varsayma, temellerden inÅŸa et\n2. AÅŸamalÄ± KarmaÅŸÄ±klÄ±k: Basit baÅŸla, doÄŸal olarak zorlaÅŸ\n3. Derin AnlayÄ±ÅŸ: Ezberleme baÅŸarÄ±sÄ±zlÄ±ktÄ±r, kavramayÄ± hedefle\n4. Hata Ã–ÄŸretimidir: YanlÄ±ÅŸ cevaplar Ã¶ÄŸretim fÄ±rsatÄ±dÄ±r\n5. GerÃ§ek DÃ¼nya BaÄŸlantÄ±sÄ±: Soyut kavramlarÄ± somut Ã¶rneklerle destekle\n\nSINAV BAÄLAMI:\n- SÄ±nav: ${n.name}\n- Konu: ${a}\n- Konular: ${t.join(", ")||"kapsamlÄ±"}\n- Zorluk: ${i}\n- Soru SayÄ±sÄ±: ${s}\n- ÅÄ±k SayÄ±sÄ±: 5 (A, B, C, D, E)\n- Bloom Seviyeleri: ${n.bloomPreference.join(" â†’ ")}\n\nKRÄ°TÄ°K KURAL - DOÄRU CEVAP DAÄILIMI:\nâš ï¸ DOÄRU CEVAP HER ZAMAN A OLMAMALI!\n- DoÄŸru cevaplarÄ± A, B, C, D, E arasÄ±nda RASTGELE daÄŸÄ±t\n- Her soru iÃ§in doÄŸru cevabÄ± farklÄ± ÅŸÄ±klara yerleÅŸtir\n- Ã–rnek daÄŸÄ±lÄ±m: Soru 1â†’C, Soru 2â†’A, Soru 3â†’E, Soru 4â†’B, Soru 5â†’D\n- Bu Ã¶ÄŸrencilerin ÅŸÄ±k desenlerini ezberlemesini Ã¶nler\n\nSORU YAPISI:\n\nPHASE 1 - TEMEL (Ä°lk ${Math.ceil(.3*s)} soru):\n- Bloom: Remember â†’ Understand\n- YÃ¼k: DÃ¼ÅŸÃ¼k-Orta\n- AÃ§Ä±klama: 500-700 kelime\n- Odak: TanÄ±mlar, temel kavramlar, basit uygulamalar\n\nPHASE 2 - UYGULAMA (Orta ${Math.ceil(.4*s)} soru):\n- Bloom: Apply â†’ Analyze\n- YÃ¼k: Orta-YÃ¼ksek\n- AÃ§Ä±klama: 600-800 kelime\n- Odak: Problem Ã§Ã¶zme, analiz, Ã§oklu adÄ±mlar\n\nPHASE 3 - USTALIK (Son ${Math.ceil(.3*s)} soru):\n- Bloom: Evaluate â†’ Create\n- YÃ¼k: Ã‡ok YÃ¼ksek\n- AÃ§Ä±klama: 700-900 kelime\n- Odak: Sentez, deÄŸerlendirme, yaratÄ±cÄ± Ã§Ã¶zÃ¼mler\n\n5 ÅIKLI SORU FORMATI:\nHer soru iÃ§in:\n- 1 doÄŸru cevap (A, B, C, D veya E - RASTGELE)\n- 4 Ã§eldirici (yanlÄ±ÅŸ seÃ§enekler)\n\nÃ‡eldirici tasarÄ±mÄ±:\n- Ã‡eldirici 1: YaygÄ±n kavram hatasÄ±\n- Ã‡eldirici 2: ProsedÃ¼r/hesaplama hatasÄ±\n- Ã‡eldirici 3: KÄ±smi doÄŸru ama eksik\n- Ã‡eldirici 4: Bilgi eksikliÄŸi/karÄ±ÅŸtÄ±rma\n\nAÃ‡IKLAMA YAPISI:\nHer soru iÃ§in detaylÄ± aÃ§Ä±klama ÅŸunlarÄ± iÃ§ermeli:\n\n**ğŸ¯ KAVRAM TEMELÄ°:** (150-200 kelime)\n- Ana kavram nedir?\n- Neden Ã¶nemli?\n- GÃ¼nlÃ¼k hayattan Ã¶rnek\n\n**ğŸ“Š ADIM ADIM Ã‡Ã–ZÃœM:** (200-300 kelime)\n1. Problem analizi\n2. Ã‡Ã¶zÃ¼m yÃ¶ntemi seÃ§imi\n3. AdÄ±m adÄ±m uygulama\n4. DoÄŸrulama\n\n**ğŸ’¡ UZMAN DÃœÅÃœNCESÄ°:** (150-200 kelime)\n- Uzmanlar nasÄ±l yaklaÅŸÄ±r?\n- BaÅŸlangÄ±Ã§ seviyesi hatalar nelerdir?\n- Ä°puÃ§larÄ± ve stratejiler\n\n**âŒ YANLIÅ CEVAP ANALÄ°ZÄ°:** (200-250 kelime)\nHer yanlÄ±ÅŸ seÃ§enek iÃ§in (4 Ã§eldirici):\n- Hangi kavram hatasÄ± bu seÃ§eneÄŸe gÃ¶tÃ¼rÃ¼r?\n- Ne sÄ±klÄ±kta yapÄ±lÄ±r?\n- NasÄ±l Ã¶nlenir?\n\n**âœ… DOÄRU CEVAP AÃ‡IKLAMASI:** (100-150 kelime)\n- Neden bu seÃ§enek doÄŸru?\n- DiÄŸerlerinden farkÄ± ne?\n- Hangi bilgi/mantÄ±k bunu doÄŸru yapÄ±yor?\n\n**ğŸ”„ PRATÄ°K Ã–NERÄ°LERÄ°:** (100-150 kelime)\n- Benzer problemler\n- Ã‡alÄ±ÅŸma stratejileri\n- Ä°leri seviye baÄŸlantÄ±lar\n\nKALÄ°TE STANDARTLARI:\nâœ“ %100 bilimsel doÄŸruluk\nâœ“ Bloom taksonomisi ilerlemesi\nâœ“ Her soru 5 ÅŸÄ±klÄ± (A, B, C, D, E)\nâœ“ DoÄŸru cevaplar RASTGELE daÄŸÄ±tÄ±lmÄ±ÅŸ\nâœ“ Her Ã§eldirici belirli bir hatayÄ± temsil eder\nâœ“ AÃ§Ä±klamalar Ã¶ÄŸretici, sadece bilgilendirici deÄŸil\nâœ“ TÃ¼rkÃ§e karakter kullanÄ±mÄ± doÄŸru (Ä±,ÅŸ,ÄŸ,Ã¼,Ã¶,Ã§,Ä°)\nâœ“ Profesyonel ama eriÅŸilebilir dil\n\nÃ‡IKTI FORMATI:\nSadece geÃ§erli JSON dÃ¶ndÃ¼r, markdown veya yorum yok:\n\n{\n  "title": "AÃ§Ä±klayÄ±cÄ± baÅŸlÄ±k",\n  "description": "Pedagojik yaklaÅŸÄ±m aÃ§Ä±klamasÄ± (200+ kelime)",\n  "metadata": {\n    "examType": "${e.examType}",\n    "examName": "${n.name}",\n    "subject": "${a}",\n    "topics": ${JSON.stringify(t)},\n    "difficulty": "${i}",\n    "questionCount": ${s},\n    "optionCount": 5,\n    "pedagogicalFramework": "Testify AI Professional v12.0",\n    "bloomProgression": "${n.bloomPreference.join(" â†’ ")}",\n    "qualityTarget": "Profesyonel Akademik Standart",\n    "model": "gpt-5-nano",\n    "answerDistribution": "Randomized (A, B, C, D, E)"\n  },\n  "questions": [\n    {\n      "id": "q1",\n      "phase": "foundation|application|mastery",\n      "bloomLevel": "remember|understand|apply|analyze|evaluate|create",\n      "cognitiveLoad": "low|medium|high|very-high",\n      "q": "Soru metni - aÃ§Ä±k, net, profesyonel",\n      "o": [\n        "A) SeÃ§enek 1",\n        "B) SeÃ§enek 2",\n        "C) SeÃ§enek 3",\n        "D) SeÃ§enek 4",\n        "E) SeÃ§enek 5"\n      ],\n      "a": "C",\n      "explanation": "KapsamlÄ± Ã¶ÄŸretici iÃ§erik (500-900 kelime, markdown formatlÄ±)",\n      "difficulty": "${i}",\n      "estimatedTime": ${n.questionTime},\n      "topics": ["${a}"],\n      "prerequisites": ["kavram1", "kavram2"],\n      "learningObjectives": ["hedef1", "hedef2"],\n      "commonErrors": [\n        {\n          "option": "A",\n          "error": "Spesifik hata aÃ§Ä±klamasÄ±",\n          "frequency": "15%",\n          "rootCause": "Temel yanlÄ±ÅŸ anlama",\n          "remediation": "Ã‡alÄ±ÅŸma stratejisi"\n        },\n        {\n          "option": "B",\n          "error": "FarklÄ± hata tÃ¼rÃ¼",\n          "frequency": "25%",\n          "rootCause": "ProsedÃ¼r hatasÄ±",\n          "remediation": "Dikkat edilmesi gerekenler"\n        },\n        {\n          "option": "D",\n          "error": "BaÅŸka bir yaygÄ±n hata",\n          "frequency": "20%",\n          "rootCause": "Bilgi eksikliÄŸi",\n          "remediation": "Ek Ã§alÄ±ÅŸma konusu"\n        },\n        {\n          "option": "E",\n          "error": "DÃ¶rdÃ¼ncÃ¼ Ã§eldirici",\n          "frequency": "10%",\n          "rootCause": "KarÄ±ÅŸtÄ±rma",\n          "remediation": "AyÄ±rt etme stratejisi"\n        }\n      ]\n    }\n  ]\n}\n\nÃ–NEMLÄ° HATIRLATMALAR:\n1. Her soru MUTLAKA 5 ÅŸÄ±klÄ± olmalÄ± (A, B, C, D, E)\n2. DoÄŸru cevap ("a" alanÄ±) A, B, C, D veya E olabilir - RASTGELE daÄŸÄ±t\n3. Soru 1 â†’ Ã¶rn. C doÄŸru, Soru 2 â†’ Ã¶rn. A doÄŸru, Soru 3 â†’ Ã¶rn. E doÄŸru...\n4. Asla tÃ¼m sorularda A doÄŸru cevap olmasÄ±n\n5. commonErrors dizisinde 4 Ã§eldirici analizi olmalÄ± (doÄŸru cevap hariÃ§ diÄŸer 4 ÅŸÄ±k)`,userPrompt:`${a} konusunda ${s} adet profesyonel sÄ±nav sorusu oluÅŸtur.\n\nKULLANICI TALEBÄ°: ${e.originalRequest}\n\nGEREKSINIMLER:\n- ${s} soru\n- Her soru 5 ÅŸÄ±klÄ± (A, B, C, D, E)\n- DoÄŸru cevaplar RASTGELE daÄŸÄ±tÄ±lmalÄ±\n- Zorluk: ${i}\n- SÄ±nav: ${n.name}\n- Konu: ${a}\n- Konular: ${t.length>0?t.join(", "):"kapsamlÄ±"}\n- TÃ¼rkÃ§e (doÄŸru karakterler: Ä±,ÅŸ,ÄŸ,Ã¼,Ã¶,Ã§,Ä°)\n\nDOÄRU CEVAP DAÄILIMI:\nâš ï¸ Ã‡OK Ã–NEMLÄ°: Her soruda doÄŸru cevap farklÄ± ÅŸÄ±kta olsun!\nÃ–rnek: Soru 1â†’B, Soru 2â†’D, Soru 3â†’A, Soru 4â†’E, Soru 5â†’C...\n\nPEDAGOJIK HEDEFLER:\n1. Temel (${Math.ceil(.3*s)} soru): 500-700 kelime/soru\n2. Uygulama (${Math.ceil(.4*s)} soru): 600-800 kelime/soru\n3. UstalÄ±k (${Math.ceil(.3*s)} soru): 700-900 kelime/soru\n\nSadece geÃ§erli JSON dÃ¶ndÃ¼r.`}},relabelQuestionOptions(e,n){if(!e||!Array.isArray(e.o)||0===e.o.length)return;const a=/^\s*([A-E])\)\s*(.*)$/i,t=e.o.map(((e,n)=>{const t=String(e),i=t.match(a);if(i)return{oldLabel:i[1].toUpperCase(),text:i[2].trim()};return{oldLabel:String.fromCharCode(65+n),text:t.trim()}})),i=["A","B","C","D","E"].slice(0,t.length),s=i.includes((n||"").toUpperCase())?(n||"").toUpperCase():i[0],r=(e.a||"").toString().trim().toUpperCase();let o=t.findIndex((e=>e.oldLabel===r));-1===o&&(o=0);const l={};t[o].newLabel=s,l[t[o].oldLabel]=s;const m=i.filter((e=>e!==s));this.shuffleArray(m);let d=0;t.forEach(((e,n)=>{if(n===o)return;const a=m[d]||m[m.length-1]||i[0];d++,e.newLabel=a,l[e.oldLabel]=a})),e.o=t.map((e=>`${e.newLabel}) ${e.text}`)),e.a=s,Array.isArray(e.commonErrors)&&(e.commonErrors=e.commonErrors.map((e=>{if(!e||!e.option)return e;const n=String(e.option).trim().toUpperCase();return l[n]?{...e,option:l[n]}:e})))},rebalanceAnswerDistribution(e){if(!e||!Array.isArray(e.questions)||0===e.questions.length)return;const n=e.questions,a=n.length,t=["A","B","C","D","E"],i=Math.floor(a/t.length);let s=a%t.length;const r={};t.forEach((e=>{r[e]=i}));let o=0;for(;s>0;){const e=t[o%t.length];r[e]++,s--,o++}const l=[];t.forEach((e=>{for(let n=0;n<r[e];n++)l.push(e)})),this.shuffleArray(l),n.forEach(((e,n)=>{const a=l[n]||t[n%t.length];this.relabelQuestionOptions(e,a)}));const m={A:0,B:0,C:0,D:0,E:0};n.forEach((e=>{const n=(e.a||"").toString().toUpperCase();m.hasOwnProperty(n)&&m[n]++})),e.metadata=e.metadata||{},e.metadata.answerDistributionDetail=m,e.metadata.answerDistribution="Balanced randomized (Aâ€“E)"},async callAPIWithRetry(e,n=0){const a=[9e4,12e4,18e4],t=a[n]||a[a.length-1];try{console.log(`ğŸŒ Backend isteÄŸi (deneme ${n+1}/4)`),console.log(`â±ï¸ Zaman aÅŸÄ±mÄ±: ${t/1e3}s`),await this.requestManager.waitIfNeeded();const a=new AbortController,i=setTimeout((()=>a.abort()),t),s=window.TESTIFY_BACKEND_URL||"",r=`${s.endsWith("/")?s.slice(0,-1):s}/api/testify/generate-test`.replace(/^\/\//,"/"),o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemPrompt:e.systemPrompt,userPrompt:e.userPrompt,params:e.params||{},client:"Testify-Web",clientVersion:this.version,model:"gpt-5-nano",response_format:"json_testify_v12"}),signal:a.signal});if(clearTimeout(i),!o.ok){let a=`HTTP ${o.status}`,t=null;try{t=await o.json(),t&&(t.error||t.message)&&(a=t.error?.message||t.error||t.message||a)}catch(e){}if((429===o.status||500===o.status||503===o.status)&&n<3){const a=2e3*Math.pow(2,n);return console.log(`â³ Sunucu meÅŸgul. ${a/1e3}s bekleniyor...`),await new Promise((e=>setTimeout(e,a))),this.callAPIWithRetry(e,n+1)}throw new Error(a)}const l=await o.json();if(l&&!1===l.success)throw new Error(l.message||l.error||"Sunucu isteÄŸi baÅŸarÄ±sÄ±z oldu.");return l}catch(a){if("AbortError"===a.name){if(n<3)return console.log("â±ï¸ Zaman aÅŸÄ±mÄ±. Tekrar deneniyor..."),this.callAPIWithRetry(e,n+1);throw new Error("Ä°stek zaman aÅŸÄ±mÄ±na uÄŸradÄ±. LÃ¼tfen daha az soru sayÄ±sÄ± deneyin.")}if(n<3&&(a.message||"").toLowerCase().includes("network"))return console.log("ğŸ”„ AÄŸ hatasÄ±. Tekrar deneniyor..."),await new Promise((e=>setTimeout(e,2e3))),this.callAPIWithRetry(e,n+1);throw a}},async generateTestFromAI(e,n={}){if(this.state.isGenerating)this.addMessage("â³ **Profesyonel iÃ§erik hazÄ±rlanÄ±yor...**\n\nTestify AI sistemi ÅŸu anda Ã§alÄ±ÅŸÄ±yor.\nLÃ¼tfen bekleyin, yÃ¼ksek kaliteli eÄŸitim iÃ§eriÄŸi oluÅŸturuluyor.","ai");else{this.state.isGenerating=!0,this.state.lastRequest=Date.now(),this.showTypingIndicator(),console.log("â•".repeat(80)),console.log("ğŸ“ TESTIFY AI v12.0 PROFESSIONAL (Backend + GPT-5-nano)"),console.log("Model: GPT-5-nano (backend Ã¼zerinden)"),console.log("â•".repeat(80));try{const a=window.TestifyAI_Final?.parseRequest(e,n)||{subject:"Genel",questionCount:10,difficulty:"orta",topics:[],originalRequest:e,examType:"generic",examInfo:{name:"Genel Test",questionTime:90,optionCount:5,bloomPreference:["understand","apply","analyze"],osymStandards:!1}};console.log(`\nğŸ“š Konu: ${a.subject}`),console.log(`ğŸ¯ SÄ±nav: ${a.examInfo.name}`),console.log(`ğŸ’ª Zorluk: ${a.difficulty}`),console.log(`ğŸ“Š Soru SayÄ±sÄ±: ${a.questionCount}`),console.log("ğŸ”¢ ÅÄ±k SayÄ±sÄ±: 5 (A, B, C, D, E)"),console.log("ğŸ² DoÄŸru Cevap: Rastgele (ve dengeli) daÄŸÄ±tÄ±lÄ±yor");const{systemPrompt:t,userPrompt:i}=this.buildPrompt(a),s=this.estimateTokens(t),r=s+this.estimateTokens(i);console.log(`\nğŸ“ Prompt: ~${r} token`),console.log("ğŸ¤– Backend API Ã§aÄŸrÄ±sÄ± baÅŸlatÄ±lÄ±yor...");const o=Date.now(),l=await this.callAPIWithRetry({systemPrompt:t,userPrompt:i,params:a}),m=((Date.now()-o)/1e3).toFixed(2);let d={},c=null;if(l&&l.testData)c=l.testData,d=l.usage||{};else if(l&&l.data&&l.data.testData)c=l.data.testData,d=l.data.usage||l.usage||{};else{const e=l;d=e.usage||{};let n=e.choices&&e.choices[0]&&e.choices[0].message&&e.choices[0].message.content?e.choices[0].message.content:"";n=n.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim(),c=JSON.parse(n)}if(console.log("\nâœ… Ä°Ã§erik oluÅŸturuldu!"),console.log(`â±ï¸ SÃ¼re: ${m}s`),console.log(`ğŸ“Š Tokenler: ${d.total_tokens||"N/A"}`),this.rebalanceAnswerDistribution(c),c.questions&&c.questions.length>0){const e={};c.questions.forEach((n=>{const a=(n.a||"").toString().toUpperCase();e[a]=(e[a]||0)+1})),console.log("\nğŸ“Š DoÄŸru Cevap DaÄŸÄ±lÄ±mÄ± (dengelenmiÅŸ):"),Object.entries(e).forEach((([e,n])=>{console.log(`   ${e}: ${n} soru`)})),c.metadata=c.metadata||{},c.metadata.answerDistributionDetail=e,c.metadata.answerDistribution="Balanced randomized (Aâ€“E)"}c.metadata=c.metadata||{},c.metadata.generatedWith=`Testify AI v${this.version}`,c.metadata.model=l.model||c.metadata.model||"gpt-5-nano",c.metadata.generationTime=`${m}s`,c.metadata.tokens=d.total_tokens,c.metadata.timestamp=(new Date).toISOString(),c.metadata.optionCount=5,this.state.currentTest=c,this.saveGeneratedTest(c),this.hideTypingIndicator();const u=c.questions?.length||0;return this.addMessage(`## âœ¨ Profesyonel EÄŸitim Ä°Ã§eriÄŸi HazÄ±r!\n\n### ğŸ“ ${c.title}\n\n${c.description}\n\n${"â”".repeat(60)}\n\n**ğŸ“Š Ä°Ã§erik Ã–zellikleri**\n\nâ€¢ **SÄ±nav:** ${c.metadata.examName||"KapsamlÄ± Test"}\nâ€¢ **Konu:** ${c.metadata.subject||"Belirtilmedi"}\nâ€¢ **Soru SayÄ±sÄ±:** ${u}\nâ€¢ **ÅÄ±k SayÄ±sÄ±:** 5 (A, B, C, D, E)\nâ€¢ **Zorluk:** ${c.metadata.difficulty||"KarÄ±ÅŸÄ±k"}\nâ€¢ **DoÄŸru Cevaplar:** Dengeli ve rastgele daÄŸÄ±tÄ±lmÄ±ÅŸ\n\n**âš™ï¸ Teknik Detaylar**\n\nâ€¢ Model: ${c.metadata.model}\nâ€¢ SÃ¼re: ${c.metadata.generationTime}\nâ€¢ Tokenler: ${c.metadata.tokens||"N/A"}\n\n${"â”".repeat(60)}\n\n### ğŸ¯ Åimdi Ne YapmalÄ±sÄ±n?\n\n1. **"ğŸ“ Test Ã‡Ã¶z"** sekmesine git\n2. Testi dikkatlice Ã§Ã¶z\n3. **AÃ§Ä±klamalarÄ± mutlaka oku** (en deÄŸerli kÄ±sÄ±m!)\n4. YanlÄ±ÅŸ cevaplardan Ã¶ÄŸren\n5. Pratik yaparak pekiÅŸtir\n\nğŸŒŸ **BaÅŸarÄ±lar!** Testify ile profesyonel eÄŸitim.`,"ai"),this.highlightTestTab(),console.log(`\n${"â•".repeat(80)}`),console.log("âœ… PROFESYONEL EÄÄ°TÄ°M Ä°Ã‡ERÄ°ÄÄ° OLUÅTURULDU (Backend)"),console.log(`${"â•".repeat(80)}\n`),c}catch(e){console.error(`\n${"â•".repeat(80)}`),console.error("âŒ Ä°Ã‡ERÄ°K OLUÅTURMA HATASI (Backend)"),console.error(`${"â•".repeat(80)}`),console.error(`Hata: ${e.message}`),console.error(`${"â•".repeat(80)}\n`),this.hideTypingIndicator();let n=`## âŒ Ä°Ã§erik OluÅŸturulamadÄ±\n\n**Hata:** ${e.message}\n\n`;throw e.message.includes("Zaman aÅŸÄ±mÄ±")?n+="**Ã‡Ã¶zÃ¼m:**\nâ€¢ Daha az soru sayÄ±sÄ± deneyin\nâ€¢ Konuyu daha spesifik yapÄ±n\nâ€¢ Sistem otomatik tekrar deneyecek":e.message.includes("429")||e.message.includes("rate limit")?n+="**Ã‡Ã¶zÃ¼m:**\nâ€¢ Bir sÃ¼re bekleyip tekrar deneyin\nâ€¢ Sunucu yoÄŸunluÄŸu azalÄ±nca deneyin":n+="**Ã‡Ã¶zÃ¼m:**\nâ€¢ LÃ¼tfen tekrar deneyin\nâ€¢ FarklÄ± parametreler deneyin\nâ€¢ Sorun devam ederse geliÅŸtiriciye iletin",this.addMessage(n,"ai"),e}finally{this.state.isGenerating=!1}}},saveGeneratedTest(e){try{const n=Date.now()+864e5;e.expiresAt=n,localStorage.setItem("testify_generated_test",JSON.stringify(e)),localStorage.setItem("testify_current_test",JSON.stringify(e)),console.log("âœ“ Test kaydedildi (AI, 24 saat geÃ§erli)")}catch(e){console.error("âŒ Test kaydedilemedi:",e)}},loadSavedTest(){try{const e=localStorage.getItem("testify_current_test");if(e)return this.state.currentTest=JSON.parse(e),this.state.currentTest}catch(e){console.error("âŒ Test yÃ¼klenemedi:",e)}return null},init(){console.log("ğŸš€ TestifyAI.init() Ã§aÄŸrÄ±ldÄ±"),this.initUI(),this.loadSavedTest()}};window.TestifyAI=TestifyAI,window.openAiPanel=()=>window.TestifyAI&&TestifyAI.openPanel(),window.closeAiPanel=()=>window.TestifyAI&&TestifyAI.closePanel(),window.toggleAiPanel=()=>window.TestifyAI&&TestifyAI.togglePanel(),window.minimizeAiPanel=()=>window.TestifyAI&&TestifyAI.toggleMinimize(),console.log("\n"+"â•".repeat(80)),console.log("ğŸ“ TESTIFY AI v12.0.1 PROFESSIONAL (Backend + GPT-5-nano)"),console.log("â•".repeat(80)),console.log("\nğŸ“š Model: GPT-5-nano (backend Ã¼zerinden)"),console.log("ğŸ¯ Quality: Professional Academic Standard"),console.log("ğŸ”¬ Framework: Research-Based Pedagogy"),console.log("ğŸ”¢ Format: 5 Options (A, B, C, D, E)"),console.log("ğŸ² Answers: Balanced randomized distribution\n"),console.log("â”".repeat(80)),console.log("âœ¨ Testify AI hazÄ±r (UI + Test Ã¼retimi, backend ile)!"),console.log("â”".repeat(80)+"\n");
