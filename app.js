"use strict";"function"!=typeof window.t&&(window.t=function(t,e){return e});const App={init(){console.log("ğŸ“ Testify baÅŸlatÄ±lÄ±yor...");try{this.checkStorage(),this.loadUserData(),this.loadTheme(),this.attachEventListeners(),this.updateDashboard(),this.updateLeaderboard(),console.log("âœ… Testify hazÄ±r!")}catch(t){console.error("âŒ BaÅŸlatma hatasÄ±:",t),Utils.handleError(t,"App.init")}},checkStorage(){try{const t="__storage_test__";localStorage.setItem(t,t),localStorage.removeItem(t)}catch(t){Utils.showToast("LocalStorage kullanÄ±lamÄ±yor! Veriler kaydedilmeyecek.","warning"),console.error("Storage hatasÄ±:",t)}},loadUserData(){try{const e=StorageManager.getUserData(),a=document.getElementById("userAvatar"),n=document.getElementById("streak"),o=document.getElementById("totalPoints"),s=document.getElementById("rank");if(a){const t=e.username||"U";a.textContent=t.charAt(0).toUpperCase()}if(n){const a=t("header.streak","GÃ¼n");n.querySelector('span[data-i18n="header.streak"]')?n.innerHTML=`${e.stats.streak} <span data-i18n="header.streak">${a}</span>`:n.textContent=e.stats.streak+" "+a}if(o){const a=t("header.points","XP");o.querySelector('span[data-i18n="header.points"]')?o.innerHTML=`${e.stats.xp} <span data-i18n="header.points">${a}</span>`:o.textContent=e.stats.xp+" "+a}s&&(s.textContent=e.stats.rank?"#"+e.stats.rank:"#--")}catch(t){console.error("KullanÄ±cÄ± verisi yÃ¼kleme hatasÄ±:",t),Utils.handleError(t,"loadUserData")}},themeManager:{toggle(){const t=document.documentElement,e="light"===t.getAttribute("data-theme")?"dark":"light";t.setAttribute("data-theme",e);const a=document.getElementById("themeIcon");a&&(a.textContent="light"===e?"â˜€ï¸":"ğŸŒ™");const n=document.querySelector(".theme-toggle");n&&n.setAttribute("aria-pressed","dark"===e),Utils.setToStorage(Config.STORAGE_KEYS.THEME,e)}},loadTheme(){const t=Utils.getFromStorage(Config.STORAGE_KEYS.THEME,"light");document.documentElement.setAttribute("data-theme",t);const e=document.getElementById("themeIcon");e&&(e.textContent="light"===t?"â˜€ï¸":"ğŸŒ™");const a=document.querySelector(".theme-toggle");a&&a.setAttribute("aria-pressed","dark"===t)},showLoadingOverlay(){try{const t=document.getElementById("loadingOverlay");t&&(t.style.display="flex",t.setAttribute("aria-hidden","false"))}catch(t){console.error("Loading overlay gÃ¶sterilemedi:",t)}},hideLoadingOverlay(){try{const t=document.getElementById("loadingOverlay");t&&(t.style.display="none",t.setAttribute("aria-hidden","true"))}catch(t){console.error("Loading overlay gizlenemedi:",t)}},handleInitialTabFromHash(){try{const t=window.location.hash?window.location.hash.replace("#",""):"",e="dashboard",a=t&&document.getElementById(t)?t:e;a!==e?this.switchTab(a,{skipHistory:!0}):window.history&&window.history.replaceState?window.history.replaceState({tab:e},"","#"+e):window.location.hash="#"+e}catch(t){console.error("Ä°lk sekme ayarlama hatasÄ±:",t)}},switchTab(t,e={}){try{switch(this.showLoadingOverlay(),document.querySelectorAll(".nav-tab").forEach((e=>{const a=e.dataset.tab===t;e.classList.toggle("active",a),e.setAttribute("aria-selected",a)})),document.querySelectorAll(".tab-content").forEach((e=>{e.classList.toggle("active",e.id===t)})),t){case"library":window.LibraryManager&&"function"==typeof LibraryManager.loadLibrary?LibraryManager.loadLibrary():(console.warn("âš ï¸ LibraryManager henÃ¼z yÃ¼klenmedi"),setTimeout((()=>{window.LibraryManager?LibraryManager.loadLibrary():console.error("âŒ LibraryManager yÃ¼klenemedi")}),100));break;case"leaderboard":this.updateLeaderboard();break;case"notes":this.updateNotes();break;case"analysis":this.updateAnalysis();break;case"dashboard":this.updateDashboard()}e.skipHistory||(window.history&&window.history.pushState?window.history.pushState({tab:t},"","#"+t):window.location.hash="#"+t),setTimeout((()=>{this.hideLoadingOverlay(),window.scrollTo({top:0,behavior:"smooth"})}),200)}catch(t){console.error("Tab deÄŸiÅŸtirme hatasÄ±:",t),Utils.handleError(t,"switchTab"),this.hideLoadingOverlay()}},updateDashboard(){try{const t=StorageManager.getUserData().stats,e=document.getElementById("totalTests"),a=document.getElementById("totalQuestions"),n=document.getElementById("successRate"),o=document.getElementById("avgTime");if(e&&(e.textContent=t.totalTests),a&&(a.textContent=t.totalQuestions),n){const e=t.totalQuestions>0?Math.round(t.correctAnswers/t.totalQuestions*100):0;n.textContent=e+"%"}if(o){const e=t.totalTests>0?Math.round(t.totalTime/t.totalTests):0;o.textContent=e+"s"}this.updateActivityList()}catch(t){console.error("Dashboard gÃ¼ncelleme hatasÄ±:",t),Utils.handleError(t,"updateDashboard")}},updateActivityList(){try{const e=StorageManager.getActivities(5),a=document.getElementById("activityList");if(!a)return;if(0===e.length){const e=t("dashboard.empty","HenÃ¼z aktivite yok. Test Ã§Ã¶zerek baÅŸla!");return void(a.innerHTML=`\n                    <div class="empty-state">\n                        <div class="empty-state-icon">ğŸ“Š</div>\n                        <p>${e}</p>\n                    </div>\n                `)}a.innerHTML=e.map((t=>`\n                <div class="activity-item" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 10px;">\n                    <div style="display: flex; justify-content: space-between; align-items: center;">\n                        <div>\n                            <strong>${this.getActivityTitle(t)}</strong>\n                            <p style="margin: 5px 0 0; color: var(--text-secondary); font-size: 0.9rem;">\n                                ${this.getActivityDescription(t)}\n                            </p>\n                        </div>\n                        <small style="color: var(--text-tertiary);">\n                            ${Utils.formatDate(t.timestamp)}\n                        </small>\n                    </div>\n                </div>\n            `)).join("")}catch(t){console.error("Aktivite listesi hatasÄ±:",t)}},getActivityTitle:e=>({test_completed:"âœ… "+t("activity.testCompleted","Test TamamlandÄ±"),test_saved:"ğŸ’¾ "+t("activity.testSaved","Test Kaydedildi"),test_exported:"ğŸ“¥ "+t("activity.testExported","Test Ä°ndirildi"),note_created:"ğŸ“ "+t("activity.noteCreated","Not OluÅŸturuldu"),level_up:"ğŸ‰ "+t("activity.levelUp","Level AtlandÄ±")}[e.type]||"Aktivite"),getActivityDescription(t){switch(t.type){case"test_completed":return`${t.data.correctAnswers}/${t.data.totalQuestions} doÄŸru - %${t.data.successRate} baÅŸarÄ±`;case"test_saved":return`${t.data.title} - ${t.data.questionCount} soru`;case"test_exported":return`${t.data.title} - ${t.data.format.toUpperCase()}`;case"note_created":return t.data.title||"Yeni not";case"level_up":return`Level ${t.data.level}!`;default:return""}},updateLeaderboard(){try{const e=StorageManager.getLeaderboard(100),a=document.getElementById("leaderboardBody");if(!a)return;if(0===e.length){const e=t("leaderboard.empty","HenÃ¼z veri bulunmuyor");return void(a.innerHTML=`\n                    <tr>\n                        <td colspan="5" class="empty-cell">${e}</td>\n                    </tr>\n                `)}a.innerHTML=e.map((t=>`\n                <tr>\n                    <td>\n                        <span class="rank-badge ${this.getRankClass(t.rank)}">${t.rank}</span>\n                    </td>\n                    <td>\n                        <div class="user-info">\n                            <div class="user-avatar-small">${t.username.charAt(0).toUpperCase()}</div>\n                            <span>${Utils.sanitizeHTML(t.username)}</span>\n                        </div>\n                    </td>\n                    <td><strong>${t.xp} XP</strong></td>\n                    <td>${t.totalTests}</td>\n                    <td><span style="color: var(--success);">${t.successRate}%</span></td>\n                </tr>\n            `)).join("")}catch(t){console.error("Leaderboard gÃ¼ncelleme hatasÄ±:",t),Utils.handleError(t,"updateLeaderboard")}},getRankClass:t=>1===t?"rank-1":2===t?"rank-2":3===t?"rank-3":"rank-default",updateNotes(){try{const e=StorageManager.getNotes(),a=document.getElementById("notesList");if(!a)return;if(0===e.length){const e=t("notes.empty","HenÃ¼z not eklemedin");return void(a.innerHTML=`\n                    <div class="empty-state">\n                        <div class="empty-state-icon">ğŸ“</div>\n                        <p>${e}</p>\n                    </div>\n                `)}a.innerHTML=e.map((e=>{const a=t("notes.edit","DÃ¼zenle"),n=t("notes.delete","Sil");return`\n                    <div class="note-card">\n                        <h3 class="note-title">${Utils.sanitizeHTML(e.title||"BaÅŸlÄ±ksÄ±z Not")}</h3>\n                        <p class="note-content">${Utils.sanitizeHTML(e.content||"")}</p>\n                        <div class="note-meta">\n                            <span>${Utils.formatDate(e.createdAt)}</span>\n                            <div>\n                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem;" onclick="App.editNote('${e.id}')">\n                                    ${a}\n                                </button>\n                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem;" onclick="App.deleteNote('${e.id}')">\n                                    ${n}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `})).join("")}catch(t){console.error("Notlar gÃ¼ncelleme hatasÄ±:",t),Utils.handleError(t,"updateNotes")}},async addNote(){try{if(window.NoteModal&&"function"==typeof window.NoteModal.openCreate)return void window.NoteModal.openCreate();const e=t("notes.titlePrompt","Not BaÅŸlÄ±ÄŸÄ±:"),a=t("notes.contentPrompt","Not Ä°Ã§eriÄŸi:"),n=prompt(e);if(!n)return;const o={title:n,content:prompt(a)||""};StorageManager.saveNote(o)&&this.updateNotes()}catch(t){console.error("Not ekleme hatasÄ±:",t),Utils.handleError(t,"addNote")}},async editNote(e){try{const a=StorageManager.getNotes().find((t=>t.id===e));if(!a)return;if(window.NoteModal&&"function"==typeof window.NoteModal.openEdit)return void window.NoteModal.openEdit(a);const n=t("notes.titlePrompt","Not BaÅŸlÄ±ÄŸÄ±:"),o=t("notes.contentPrompt","Not Ä°Ã§eriÄŸi:"),s=prompt(n,a.title);if(null===s)return;const i=prompt(o,a.content);if(null===i)return;a.title=s,a.content=i,StorageManager.saveNote(a)&&this.updateNotes()}catch(t){console.error("Not dÃ¼zenleme hatasÄ±:",t),Utils.handleError(t,"editNote")}},async deleteNote(e){try{const a=t("notes.deleteConfirm","Bu notu silmek istediÄŸinizden emin misiniz?");await Utils.confirm(a)&&StorageManager.deleteNote(e)&&this.updateNotes()}catch(t){console.error("Not silme hatasÄ±:",t),Utils.handleError(t,"deleteNote")}},updateAnalysis(){try{const e=StorageManager.getUserData().stats,a=document.getElementById("analysisContent");if(!a)return;if(0===e.totalTests){const e=t("analysis.empty","Analiz iÃ§in daha fazla test Ã§Ã¶z");return void(a.innerHTML=`\n                    <div class="empty-state">\n                        <div class="empty-state-icon">ğŸ“ˆ</div>\n                        <p>${e}</p>\n                    </div>\n                `)}const n=Math.round(e.correctAnswers/e.totalQuestions*100),o=Math.round(e.totalTime/e.totalTests),s=t("analysis.avgSuccess","Ortalama BaÅŸarÄ±"),i=t("analysis.avgTime","Ortalama SÃ¼re"),r=t("analysis.totalCorrect","Toplam DoÄŸru"),l=t("analysis.totalWrong","Toplam YanlÄ±ÅŸ"),d=t("analysis.evaluation","Performans DeÄŸerlendirmesi");a.innerHTML=`\n                <div class="stats-grid">\n                    <div class="stat-card">\n                        <div class="stat-icon">ğŸ“Š</div>\n                        <div class="stat-value">${n}%</div>\n                        <div class="stat-label">${s}</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-icon">â±ï¸</div>\n                        <div class="stat-value">${Utils.formatTime(o)}</div>\n                        <div class="stat-label">${i}</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-icon">ğŸ¯</div>\n                        <div class="stat-value">${e.correctAnswers}</div>\n                        <div class="stat-label">${r}</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-icon">âŒ</div>\n                        <div class="stat-value">${e.wrongAnswers}</div>\n                        <div class="stat-label">${l}</div>\n                    </div>\n                </div>\n                <div style="margin-top: 30px; padding: 20px; background: var(--bg-secondary); border-radius: 10px;">\n                    <h3>${d}</h3>\n                    <p style="margin-top: 10px; line-height: 1.6;">\n                        ${this.getPerformanceText(n)}\n                    </p>\n                </div>\n            `}catch(t){console.error("Analiz gÃ¼ncelleme hatasÄ±:",t),Utils.handleError(t,"updateAnalysis")}},getPerformanceText:t=>"en"===(window.LanguageManager&&"en"===LanguageManager.currentLang?"en":"tr")?t>=90?"ğŸŒŸ Excellent! Your performance is great. Keep it up!":t>=75?"ğŸ‘ Very good! Strong performance. With a bit more study you can improve even further.":t>=60?"ğŸ’ª You are doing well! With some more practice you can reach your goals.":t>=40?"ğŸ“š You need to study more. Regular practice will help you improve.":"ğŸ¯ It is recommended to review the basics. Keep going step by step!":t>=90?"ğŸŒŸ MÃ¼kemmel! Harika bir performans gÃ¶steriyorsun. BÃ¶yle devam et!":t>=75?"ğŸ‘ Ã‡ok iyi! BaÅŸarÄ±lÄ± bir performans. Biraz daha Ã§alÄ±ÅŸarak daha da iyileÅŸtirebilirsin.":t>=60?"ğŸ’ª Ä°yi gidiyorsun! Biraz daha pratik yaparsan hedeflerine ulaÅŸabilirsin.":t>=40?"ğŸ“š Daha fazla Ã§alÄ±ÅŸma gerekiyor. DÃ¼zenli pratik yaparak geliÅŸebilirsin.":"ğŸ¯ Temel konularÄ± tekrar etmen Ã¶nerilir. YavaÅŸ yavaÅŸ ilerlemeye devam et!",saveSettings(e){e.preventDefault();try{const a=e.target,n=a.username,o=a.email,s=Utils.validateInput(n,"username"),i=Utils.validateInput(o,"email");if(!s||!i)return;const r=n.value.trim(),l=o.value.trim(),d={username:r,email:l,notifications:{email:a.emailNotif.checked,push:a.pushNotif.checked}},c=StorageManager.getUserData();if(c.username=r,c.email=l,c.settings.notifications=d.notifications,StorageManager.updateUserData(c)){const e=t("msg.saved","BaÅŸarÄ±yla kaydedildi!");Utils.showToast(e,"success"),this.loadUserData()}else{const e=t("msg.error","Bir hata oluÅŸtu!");Utils.showToast(e,"error")}}catch(t){console.error("Ayar kaydetme hatasÄ±:",t),Utils.handleError(t,"saveSettings")}},async resetSettings(){try{const e=t("settings.resetConfirm","Ayarlar varsayÄ±lan deÄŸerlere dÃ¶necek. Emin misiniz?");if(!await Utils.confirm(e))return;const a=StorageManager.getUserData(),n=document.getElementById("username"),o=document.getElementById("email"),s=document.getElementById("emailNotif"),i=document.getElementById("pushNotif");n&&(n.value=a.username),o&&(o.value=a.email||""),s&&(s.checked=!0),i&&(i.checked=!1);const r=t("msg.reset","Ayarlar sÄ±fÄ±rlandÄ±");Utils.showToast(r,"info")}catch(t){console.error("Ayar sÄ±fÄ±rlama hatasÄ±:",t),Utils.handleError(t,"resetSettings")}},handleFileUpload(e){try{const a=e.target.files[0];if(!a)return;if(a.size>Config.FILE_UPLOAD.MAX_SIZE){const e=t("error.fileSize","Dosya boyutu Ã§ok bÃ¼yÃ¼k");return void Utils.showToast(e,"error")}const n=a.name.split(".").pop().toLowerCase();if(!Config.FILE_UPLOAD.ALLOWED_TYPES.includes(n)){const e=t("error.fileType","Desteklenmeyen dosya tÃ¼rÃ¼");return void Utils.showToast(e,"error")}const o=document.getElementById("fileInfo");o&&(o.innerHTML=`\n                    <div style="display: flex; align-items: center; gap: 10px;">\n                        <span>ğŸ“„</span>\n                        <div>\n                            <div><strong>${Utils.sanitizeHTML(a.name)}</strong></div>\n                            <small style="color: var(--text-secondary);">${Utils.formatFileSize(a.size)}</small>\n                        </div>\n                    </div>\n                `);const s=document.getElementById("testNotes");if(s){const t=s.value?s.value+" ":"";s.value=`${t}Bu test iÃ§in yÃ¼klenen dosya: ${a.name} (${Utils.formatFileSize(a.size)}).`}const i=t("msg.fileUploaded","Dosya yÃ¼klendi!");Utils.showToast(i,"success")}catch(t){console.error("Dosya yÃ¼kleme hatasÄ±:",t),Utils.handleError(t,"handleFileUpload")}},attachEventListeners(){try{let t=document.getElementById("logoLink");t||(t=document.querySelector(".header .logo")),t&&t.addEventListener("click",(t=>{t.preventDefault(),this.switchTab("dashboard"),window.scrollTo({top:0,behavior:"smooth"})})),document.querySelectorAll(".nav-tab").forEach((t=>{t.addEventListener("click",(()=>this.switchTab(t.dataset.tab)))}));const e=document.getElementById("settingsForm");e&&e.addEventListener("submit",(t=>this.saveSettings(t)));const a=document.getElementById("resetBtn");a&&a.addEventListener("click",(()=>this.resetSettings()));const n=document.getElementById("fileUpload");n&&n.addEventListener("change",(t=>this.handleFileUpload(t)));const o=document.getElementById("testTitle");o&&o.addEventListener("input",(()=>{const t=document.getElementById("testTopic");t&&(t.value=o.value)}));const s=document.getElementById("addNoteBtn");s&&s.addEventListener("click",(t=>{t.preventDefault(),this.addNote()})),window.themeManager=this.themeManager,console.log("âœ… Event listener'lar eklendi")}catch(t){console.error("Event listener hatasÄ±:",t),Utils.handleError(t,"attachEventListeners")}}};document.addEventListener("DOMContentLoaded",(()=>{App.init(),App.handleInitialTabFromHash();try{"undefined"!=typeof TestifyAI&&TestifyAI&&"function"==typeof TestifyAI.init&&(TestifyAI.init(),window.TestifyAI=TestifyAI,window.aiChat=TestifyAI)}catch(t){console.error("TestifyAI init hatasÄ± (HTML):",t)}})),window.App=App,window.addEventListener("popstate",(t=>{try{const e=t.state&&t.state.tab,a=window.location.hash?window.location.hash.replace("#",""):null,n=e||a||"dashboard";document.getElementById(n)&&App.switchTab(n,{skipHistory:!0})}catch(t){console.error("popstate navigation error:",t)}})),window.navigateTo=function(t){t&&document.getElementById(t)&&App.switchTab(t)},function(){const t=Date.now();window.addEventListener("beforeunload",(()=>{const e=Math.round((Date.now()-t)/1e3);console.log("ğŸ“Š Oturum sÃ¼resi:",e,"sn")})),document.addEventListener("visibilitychange",(()=>{document.hidden?console.log("ğŸ“Š KullanÄ±cÄ± sayfadan ayrÄ±ldÄ±"):console.log("ğŸ“Š KullanÄ±cÄ± sayfaya geri dÃ¶ndÃ¼")}))}(),function(){let e,a,n,o,s,i,r,l,d=!1,c="create",u=null;function m(){d||(e=document.getElementById("noteModalOverlay"),a=document.getElementById("noteModal"),n=document.getElementById("noteTitleInput"),o=document.getElementById("noteContentInput"),s=document.getElementById("noteCancelBtn"),i=document.getElementById("noteSaveBtn"),r=document.getElementById("noteModalTitle"),l=a?a.querySelector(".confirm-dialog-message"):null,e&&a&&n&&o&&s&&i&&(s.addEventListener("click",(t=>{t.preventDefault(),y()})),i.addEventListener("click",(t=>{t.preventDefault(),p()})),e.addEventListener("click",(t=>{t.target===e&&y()})),n.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),p())})),d=!0))}function y(){e&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),c="create",u=null)}function p(){if(!d||!e)return;const t=n.value.trim(),a=o.value.trim();if(!t)return void n.focus();let s={title:t,content:a};if("edit"===c&&u&&(s.id=u),StorageManager.saveNote(s)){try{StorageManager.saveActivity({type:"note_created",data:{title:t},timestamp:Date.now()})}catch(t){console.warn("Aktivite kaydÄ± yapÄ±lamadÄ±:",t)}window.App&&"function"==typeof window.App.updateNotes&&window.App.updateNotes(),y()}}document.addEventListener("DOMContentLoaded",m),window.NoteModal={openCreate:function(){d||m(),e&&(c="create",u=null,r&&(r.textContent=t("notes.newNoteTitle","Yeni Not")),l&&(l.textContent=t("notes.newNoteMessage","Notun iÃ§in bir baÅŸlÄ±k ve iÃ§erik ekle.")),n.value="",o.value="",e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),setTimeout((()=>n.focus()),10))},openEdit:function(a){d||m(),e&&a&&(c="edit",u=a.id,r&&(r.textContent=t("notes.editNoteTitle","Notu DÃ¼zenle")),l&&(l.textContent=t("notes.editNoteMessage","Not baÅŸlÄ±ÄŸÄ±nÄ± ve iÃ§eriÄŸini gÃ¼ncelleyebilirsin.")),n.value=a.title||"",o.value=a.content||"",e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),setTimeout((()=>n.focus()),10))},close:y}}();
