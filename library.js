!function(t,e){"use strict";const a=t.t||function(t,e){return e||t},r={loadLibrary(){console.log("ğŸ“š Library loading...");const t=this.getSavedTests(),r=e.getElementById("libraryList");r?0!==t.length?(r.innerHTML=t.map((t=>this.createTestCard(t))).join(""),console.log(`âœ… ${t.length} test listelendi`)):r.innerHTML=`\n                    <div class="empty-state">\n                        <div class="empty-state-icon" aria-hidden="true">ğŸ“š</div>\n                        <p>${a("library.empty","HenÃ¼z test oluÅŸturmadÄ±n")}</p>\n                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px;">\n                            ${a("library.emptyDesc",'AI\'dan "test oluÅŸtur" diyerek baÅŸla!')}\n                        </p>\n                    </div>\n                `:console.error("âŒ #libraryList bulunamadÄ±")},createTestCard(t){const e=Date.now(),r=(t.expiresAt||0)-e,s=Math.max(0,Math.floor(r/36e5)),i=Math.max(0,Math.floor(r%36e5/6e4)),n=r>0&&s<6?"var(--danger)":"var(--text-secondary)",o=a("library.duration","dk"),l=a("library.questionsLabel",a("library.questions","Soru")),d=a("library.createdAtLabel","OluÅŸturulma"),c=r>0?`${s}h ${i}m ${a("library.remaining","kaldÄ±")}`:a("library.expired","SÃ¼resi doldu");return`\n                <div class="library-card" data-test-id="${t.id}">\n                    <div class="library-card-header">\n                        <div>\n                            <h3 class="library-card-title">ğŸ“ ${Utils.sanitizeHTML(t.title)}</h3>\n                            <p class="library-card-desc">${Utils.sanitizeHTML(t.description||"")}</p>\n                        </div>\n                        <button class="btn-icon" \n                                onclick="LibraryManager.deleteTest('${t.id}')" \n                                aria-label="${a("library.delete","Sil")}" \n                                title="${a("library.delete","Sil")}">\n                            ğŸ—‘ï¸\n                        </button>\n                    </div>\n                    \n                    <div class="library-card-info">\n                        <div class="library-info-item">\n                            <span class="info-icon">ğŸ“Š</span>\n                            <span>${t.questions.length} ${l}</span>\n                        </div>\n                        <div class="library-info-item">\n                            <span class="info-icon">â±ï¸</span>\n                            <span>~${Math.ceil(1.5*t.questions.length)} ${o}</span>\n                        </div>\n                        <div class="library-info-item">\n                            <span class="info-icon">ğŸ“…</span>\n                            <span>${d}: ${Utils.formatDate(t.createdAt)}</span>\n                        </div>\n                        <div class="library-info-item" style="color: ${n};">\n                            <span class="info-icon">â°</span>\n                            <span>${c}</span>\n                        </div>\n                    </div>\n                    \n                    <div class="library-card-actions">\n                        <button class="btn btn-primary" \n                                onclick="LibraryManager.startTest('${t.id}')" \n                                style="flex: 1;">\n                            ğŸ¯ ${a("library.start","Teste BaÅŸla")}\n                        </button>\n                        <button class="btn btn-secondary" \n                                onclick="LibraryManager.downloadTestPDF('${t.id}')"\n                                title="${a("library.download","PDF Ä°ndir")}">\n                            ğŸ“¥ ${a("library.download","PDF Ä°ndir")}\n                        </button>\n                        <button class="btn btn-secondary" \n                                onclick="LibraryManager.viewTestDetails('${t.id}')"\n                                title="${a("library.view","Ä°ncele")}">\n                            ğŸ‘ï¸ ${a("library.view","Ä°ncele")}\n                        </button>\n                    </div>\n                </div>\n            `},getSavedTests(){try{const t=[];for(let e=0;e<localStorage.length;e++){const a=localStorage.key(e);if(a&&a.startsWith("testify_library_"))try{const e=localStorage.getItem(a);if(!e)continue;const r=JSON.parse(e);r.expiresAt&&Date.now()<r.expiresAt?t.push(r):(localStorage.removeItem(a),console.log("ğŸ—‘ï¸ SÃ¼resi dolmuÅŸ test silindi:",r.title))}catch(t){console.error("Test parse hatasÄ±:",t)}}return t.sort(((t,e)=>(e.createdAt||0)-(t.createdAt||0))),t}catch(t){return console.error("âŒ Test yÃ¼kleme hatasÄ±:",t),[]}},saveTestToLibrary(e){try{const a={...e,id:e.id||"test_"+Date.now(),createdAt:e.createdAt||Date.now(),expiresAt:e.expiresAt||Date.now()+864e5},r=`testify_library_${a.id}`;return localStorage.setItem(r,JSON.stringify(a)),console.log("ğŸ’¾ Test kÃ¼tÃ¼phaneye kaydedildi:",a.title),t.StorageManager&&t.StorageManager.saveActivity({type:"test_saved",data:{title:a.title,questionCount:a.questions.length},timestamp:Date.now()}),!0}catch(t){return console.error("âŒ Test kaydetme hatasÄ±:",t),Utils.showToast(a("msg.error","Test kaydedilemedi!"),"error"),!1}},async deleteTest(t){const e=a("library.deleteConfirm","Bu testi silmek istediÄŸinden emin misin?");if(await Utils.confirm(e))try{const e=`testify_library_${t}`;localStorage.removeItem(e),this.loadLibrary(),Utils.showToast(a("msg.deleted","Test silindi!"),"success"),console.log("ğŸ—‘ï¸ Test silindi:",t)}catch(t){console.error("âŒ Test silme hatasÄ±:",t),Utils.showToast(a("msg.error","Test silinemedi!"),"error")}},startTest(r){try{const s=`testify_library_${r}`,i=localStorage.getItem(s);if(!i)return void Utils.showToast(a("msg.error","Test bulunamadÄ±!"),"error");const n=JSON.parse(i);localStorage.setItem("testify_generated_test",JSON.stringify(n));const o=e.querySelector('[data-tab="test"]');o&&o.click(),setTimeout((()=>{t.QuizManager&&"function"==typeof QuizManager.startQuiz&&QuizManager.startQuiz("ai")}),500),Utils.showToast(a("msg.testStarted","Test baÅŸlatÄ±lÄ±yor..."),"info")}catch(t){console.error("âŒ Test baÅŸlatma hatasÄ±:",t),Utils.showToast(a("msg.error","Test baÅŸlatÄ±lamadÄ±!"),"error")}},viewTestDetails(t){try{const r=`testify_library_${t}`,s=localStorage.getItem(r);if(!s)return void Utils.showToast(a("msg.error","Test bulunamadÄ±!"),"error");const i=JSON.parse(s),n=e.createElement("div");n.className="modal-overlay",n.innerHTML=`\n                    <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">\n                        <div class="modal-header">\n                            <h2>ğŸ“ ${Utils.sanitizeHTML(i.title)}</h2>\n                            <button class="modal-close" \n                                    onclick="this.closest('.modal-overlay').remove()"\n                                    aria-label="${a("common.close","Kapat")}">\n                                Ã—\n                            </button>\n                        </div>\n                        <div class="modal-body">\n                            <p style="color: var(--text-secondary); margin-bottom: 20px;">\n                                ${Utils.sanitizeHTML(i.description||"")}\n                            </p>\n                            \n                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">\n                                <div class="stat-card">\n                                    <div class="stat-icon">ğŸ“Š</div>\n                                    <div class="stat-value">${i.questions.length}</div>\n                                    <div class="stat-label">${a("library.questionsLabel","Soru SayÄ±sÄ±")}</div>\n                                </div>\n                                <div class="stat-card">\n                                    <div class="stat-icon">â±ï¸</div>\n                                    <div class="stat-value">\n                                        ${Math.ceil(1.5*i.questions.length)} ${a("library.duration","dk")}\n                                    </div>\n                                    <div class="stat-label">${a("library.estimatedTimeLabel","Tahmini SÃ¼re")}</div>\n                                </div>\n                            </div>\n                            \n                            <h3 style="margin-bottom: 15px;">${a("library.questionsTitle","Sorular")}:</h3>\n                            <div style="display: flex; flex-direction: column; gap: 10px;">\n                                ${i.questions.map(((t,e)=>`\n                                    <div style="padding: 10px; background: var(--bg-secondary); border-radius: 8px;">\n                                        <strong>${e+1}. ${Utils.sanitizeHTML(t.q)}</strong>\n                                        <p style="margin-top: 5px; color: var(--text-secondary); font-size: 0.9rem;">\n                                            ${a("library.difficultyLabel","Zorluk")}: ${this.getDifficultyBadge(t.difficulty)}\n                                        </p>\n                                    </div>\n                                `)).join("")}\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">\n                                ${a("common.close","Kapat")}\n                            </button>\n                            <button class="btn btn-primary" onclick="LibraryManager.startTest('${t}'); this.closest('.modal-overlay').remove();">\n                                ğŸ¯ ${a("library.start","Teste BaÅŸla")}\n                            </button>\n                        </div>\n                    </div>\n                `,e.body.appendChild(n),n.addEventListener("click",(t=>{t.target===n&&n.remove()}))}catch(t){console.error("âŒ Test detay hatasÄ±:",t),Utils.showToast(a("msg.error","Test detaylarÄ± gÃ¶sterilemedi!"),"error")}},getDifficultyBadge(t){const e={easy:a("library.difficulty.easy","Kolay"),medium:a("library.difficulty.medium","Orta"),hard:a("library.difficulty.hard","Zor")},r={easy:"âœ…",medium:"âš ï¸",hard:"ğŸ”¥"};return`<span>${r[t]||r.medium} ${e[t]||e.medium}</span>`},async downloadTestPDF(e){try{const r=`testify_library_${e}`,s=localStorage.getItem(r);if(!s)return void Utils.showToast(a("msg.error","Test bulunamadÄ±!"),"error");const i=JSON.parse(s);if(Utils.showToast(a("library.pdf.creating","PDF oluÅŸturuluyor..."),"info",2e3),void 0===t.jspdf)return void Utils.showToast(a("library.pdf.error","PDF kÃ¼tÃ¼phanesi yÃ¼klenmedi!"),"error");const{jsPDF:n}=t.jspdf,o=new n({orientation:"portrait",unit:"mm",format:"a4"});let l=20;const d=297,c=20,y=7;if(o.setFontSize(18),o.setFont(void 0,"bold"),o.text(i.title,15,l),l+=10,o.setFontSize(11),o.setFont(void 0,"normal"),i.description){const t=o.splitTextToSize(i.description,180);o.text(t,15,l),l+=t.length*y}else l+=10;o.setFontSize(10);const m=t.LanguageManager&&"en"===LanguageManager.currentLang?"en-US":"tr-TR";o.text(`${a("library.questionsLabel","Soru SayÄ±sÄ±")}: ${i.questions.length}`,15,l),l+=6,o.text(`${a("library.estimatedTimeLabel","Tahmini SÃ¼re")}: ${Math.ceil(1.5*i.questions.length)} ${a("library.duration","dk")}`,15,l),l+=6,o.text(`${a("library.createdAtLabel","OluÅŸturulma")}: ${new Date(i.createdAt).toLocaleDateString(m)}`,15,l),l+=15,o.setFontSize(12),o.setFont(void 0,"bold"),o.text(a("library.pdf.title","SORULAR"),15,l),l+=10,o.setFontSize(10),o.setFont(void 0,"normal"),i.questions.forEach(((t,e)=>{l>d-c&&(o.addPage(),l=20),o.setFont(void 0,"bold");const a=`${e+1}. ${t.q}`,r=o.splitTextToSize(a,180);o.text(r,15,l),l+=r.length*y,o.setFont(void 0,"normal");const s=["A","B","C","D"];(t.o||[]).forEach(((t,e)=>{l>d-c&&(o.addPage(),l=20);const a=`${s[e]}) ${t}`,r=o.splitTextToSize(a,175);o.text(r,20,l),l+=r.length*y})),l+=5})),o.addPage(),l=20,o.setFontSize(14),o.setFont(void 0,"bold"),o.text(a("library.pdf.answerKey","CEVAP ANAHTARI"),15,l),l+=10,o.setFontSize(10),o.setFont(void 0,"normal"),i.questions.forEach(((t,e)=>{l>d-c&&(o.addPage(),l=20);const a=["A","B","C","D"][(t.o||[]).indexOf(t.a)]||"?";o.text(`${e+1}. ${a}`,15,l),l+=y}));const b=`${(i.title||"test").toLowerCase().replace(/[^a-z0-9]/gi,"_")}.pdf`;o.save(b),Utils.showToast(a("library.pdf.downloaded","PDF indirildi!"),"success"),t.StorageManager&&t.StorageManager.saveActivity({type:"test_exported",data:{title:i.title,format:"pdf"},timestamp:Date.now()})}catch(t){console.error("âŒ PDF oluÅŸturma hatasÄ±:",t),Utils.showToast(a("library.pdf.error","PDF oluÅŸturulamadÄ±!"),"error")}},cleanExpiredTests(){try{let t=0;for(let e=localStorage.length-1;e>=0;e--){const a=localStorage.key(e);if(a&&a.startsWith("testify_library_"))try{const e=localStorage.getItem(a);if(!e)continue;const r=JSON.parse(e);r.expiresAt&&Date.now()>=r.expiresAt&&(localStorage.removeItem(a),t++,console.log("ğŸ—‘ï¸ SÃ¼resi dolmuÅŸ test temizlendi:",r.title))}catch(e){localStorage.removeItem(a),t++}}t>0&&console.log(`ğŸ§¹ ${t} sÃ¼resi dolmuÅŸ test temizlendi`)}catch(t){console.error("âŒ Temizleme hatasÄ±:",t)}},init(){console.log("ğŸ“š Library Manager baÅŸlatÄ±lÄ±yor..."),this.cleanExpiredTests(),setInterval((()=>{this.cleanExpiredTests()}),6e5),console.log("âœ… Library Manager hazÄ±r!")}};e.addEventListener("DOMContentLoaded",(()=>{r.init()})),t.LibraryManager=r}(window,document);
